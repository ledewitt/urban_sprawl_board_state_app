<html>
  <head>
    <link rel="stylesheet" href="./style.css">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />  
  </head>
    <script type="text/javascript" src="./node_modules/paper/dist/paper-full.js"></script>
  <body>
    <canvas id="canvas" resize></canvas>
    <img src="images/influence_token_4.png" id="influence-token-4"/>
    <img src="images/influence_token_5.png" id="influence-token-5"/>
    <img src="images/influence_token_6.png" id="influence-token-6"/>
    <img src="images/wealth_token_7.png" id="wealth-token-7"/>
    <img src="images/wealth_token_8.png" id="wealth-token-8"/>
    <img src="images/wealth_token_9.png" id="wealth-token-9"/>
    <img src="images/wealth_token_10.png" id="wealth-token-10"/>
    <img src="images/wealth_token_11.png" id="wealth-token-11"/>
    <img src="images/wealth_token_12.png" id="wealth-token-12"/>
  </body>
</html>
<script type="text/paperscript" canvas="canvas">
  

path = rectangle(30,30);
path2 = rectangle(100,30);
pieces = [path,  path2];
board_offset_x = 100;
board_offset_y = 100;
piece_size     = 60;
draw_board();
on_the_mouse = null;

function inBounds(shape) {
  return (shape.bounds["_width"] + shape.bounds["_x"] >= mouse_x &&
        shape.bounds["_x"] <= mouse_x &&
        shape.bounds["_height"] + shape.bounds["_y"] >= mouse_y &&
        shape.bounds["_y"] <= mouse_y);
}

function draw_board() {
  draw_grid(board_offset_x,board_offset_y,6,6);
  draw_prestige_side_board(board_offset_x,board_offset_y);

}

function draw_prestige_side_board(board_offset_x,board_offset_y) {
  prestige_borders= { "left_x"  :  board_offset_x,
                      "right_x" : board_offset_x + piece_size * 6,
                      "top_y"   : board_offset_y + piece_size * 6,
                      "bottom_y": board_offset_y + piece_size * 6 + piece_size * 2
  };
  prestige_markers = new Path();
  prestige_markers.strokeColor = 'black';
  var left_x   = prestige_borders["left_x"];
  right_x      = prestige_borders["right_x"];
  top_y        = board_offset_y + piece_size * 6 ;
  bottom_y     = board_offset_y + piece_size * 6 + piece_size * 2;
  prestige_markers.add(new Point(left_x,  top_y));
  prestige_markers.add(new Point(left_x,  bottom_y));
  prestige_markers.add(new Point(right_x, bottom_y));
  prestige_markers.add(new Point(right_x, top_y));
  prestige_markers.closed=true;
  for(var i = 4; i <= 6 ; i++) {
    var raster = new Raster('influence-token-' + i);
    raster.position = new Point(left_x + (i - 4) * 60 + 30,top_y + 30);
    pieces.push(raster);
  }
  for(var i = 7; i <= 12 ; i++) {
    var raster = new Raster('wealth-token-' + i);
    raster.position = new Point(left_x + (i - 7) * 60 + 30,top_y + 90);
    pieces.push(raster);
  }
}

function draw_grid(start_x,start_y,height,width) {
  for(var i = 0; i < height;    i++) {
    draw_grid_row(start_x,start_y + piece_size * i,width);
  }
}
function draw_grid_row(start_x,start_y,grid_size) {
  for(var i = 0 ; i < grid_size; i++) {
    var grid = new Path();
    grid.strokeColor = 'black';
    grid.add(new Point(start_x + piece_size * i, start_y));
    grid.add(new Point(start_x + piece_size * i, start_y + piece_size));
    grid.add(new Point(start_x + piece_size + piece_size * i, start_y + piece_size));
    grid.add(new Point(start_x + piece_size + piece_size * i, start_y));
    grid.add(new Point(start_x + piece_size * i, start_y));
    grid.closed=true;
  }
}
function onMouseDown(event) {
  mouse_x = event.point["x"];
  mouse_y = event.point["y"];
  my_piece = pieces.find(inBounds);
  if(my_piece != null) {
    on_the_mouse = my_piece;
  }

}
function onMouseUp(event) {
  if(on_the_mouse == null) {
  } else {
    var x_modulus = (event.point["x"] - 100) % piece_size;
    var y_modulus = (event.point["y"] - 100) % piece_size;
    refined_x = event.point["x"] - x_modulus + 30;
    refined_y = event.point["y"] - y_modulus + 30;
    move_to = {x: refined_x , y: refined_y};
    on_the_mouse.position = move_to;
    on_the_mouse = null;
  }
}

function rectangle(x,y) {
  var path = new Path();
  path.strokeColor = 'black';
  path.add(new Point(x, y));
  path.add(new Point(x + 60, y));
  path.add(new Point(x + 60, y));
  path.add(new Point(x + 60, y + 30));
  path.add(new Point(x + 30, y + 30));
  path.add(new Point(x + 30, y + 60));
  path.add(new Point(x, y + 60));
  path.closed=true;
  project.activeLayer.lastChild.fillColor = 'red';
  return path;
}


</script>
