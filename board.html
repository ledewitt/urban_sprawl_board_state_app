<html>
  <head>
    <link rel="stylesheet" href="./style.css">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />  
  </head>
    <script type="text/javascript" src="./node_modules/paper/dist/paper-full.js"></script>
  <body>
    <canvas id="canvas" resize></canvas>
    <img src="images/influence_token_4_tiny.png" id="influence-token-4" style="width:128px;height:128px;"/>
    <img src="images/influence_token_5_tiny.png" id="influence-token-5"/>
    <img src="images/influence_token_6_tiny.png" id="influence-token-6"/>
    <img src="images/wealth_token_7_tiny.png" id="wealth-token-7"/>
    <img src="images/wealth_token_8_tiny.png" id="wealth-token-8"/>
    <img src="images/wealth_token_9_tiny.png" id="wealth-token-9"/>
    <img src="images/wealth_token_10_tiny.png" id="wealth-token-10"/>
    <img src="images/wealth_token_11_tiny.png" id="wealth-token-11"/>
    <img src="images/wealth_token_12_tiny.png" id="wealth-token-12"/>
    <img src="images/board.jpg" id="board"/>
  </body>
</html>
<script type="text/paperscript" canvas="canvas">
  
board_offset_x = 362;
board_offset_y = 266;
piece_size     = 56;

path = rectangle(30,30);
path2 = rectangle(100,30);
pieces = [path,  path2];
draw_board();
on_the_mouse = null;

function inBounds(shape) {
  return (shape.bounds["_width"] + shape.bounds["_x"] >= mouse_x &&
        shape.bounds["_x"] <= mouse_x &&
        shape.bounds["_height"] + shape.bounds["_y"] >= mouse_y &&
        shape.bounds["_y"] <= mouse_y);
}

function draw_board() {
  draw_grid(board_offset_x,board_offset_y,6,6);
  draw_prestige_side_board(board_offset_x,board_offset_y);
  board_raster = new Raster('board');
  board_raster.position = new Point(100 + board_raster["width"]  / 2,
                                    100 + board_raster["height"] / 2);
  board_raster.sendToBack();
}

function draw_prestige_side_board(board_offset_x,board_offset_y) {
  var token_size = 27;
  console.log(piece_size);
  var prestige_borders= { "left_x"  :  board_offset_x + 60,
                      "right_x" : board_offset_x + token_size * 9 + 60,
                      "top_y"   : board_offset_y + piece_size * 6 + 110,
                      "bottom_y": board_offset_y + piece_size * 6 + token_size + 110
  };
  prestige_markers = new Path();
  prestige_markers.strokeColor = 'black';
  var left_x   = prestige_borders["left_x"];
  right_x      = prestige_borders["right_x"];
  top_y        = prestige_borders["top_y"];
  bottom_y     = prestige_borders["bottom_y"];
  prestige_markers.add(new Point(left_x,  top_y));
  prestige_markers.add(new Point(left_x,  bottom_y));
  prestige_markers.add(new Point(right_x, bottom_y));
  prestige_markers.add(new Point(right_x, top_y));
  prestige_markers.closed=true;
  for(var i = 4; i <= 6 ; i++) {
    var raster = new Raster('influence-token-' + i);
    raster.position = new Point(left_x + (i - 4) * token_size + token_size / 2,top_y + token_size / 2);
    pieces.push(raster);
  }
  for(var i = 7; i <= 12 ; i++) {
    var raster = new Raster('wealth-token-' + i);
    raster.position = new Point(left_x + (i - 4) * token_size + token_size / 2,top_y + token_size / 2);
    pieces.push(raster);
  }
}

function draw_grid(start_x,start_y,height,width) {
  for(var i = 0; i < height;    i++) {
    draw_grid_row(start_x,start_y + piece_size * i,width);
  }
}
function draw_grid_row(start_x,start_y,grid_size) {
  for(var i = 0 ; i < grid_size; i++) {
    var grid = new Path();
    grid.strokeColor = 'black';
    grid.add(new Point(start_x + piece_size * i, start_y));
    grid.add(new Point(start_x + piece_size * i, start_y + piece_size));
    grid.add(new Point(start_x + piece_size + piece_size * i, start_y + piece_size));
    grid.add(new Point(start_x + piece_size + piece_size * i, start_y));
    grid.add(new Point(start_x + piece_size * i, start_y));
    grid.closed=true;
  }
}
function onMouseDown(event) {
  mouse_x = event.point["x"];
  mouse_y = event.point["y"];
  my_piece = pieces.find(inBounds);
  if(my_piece != null) {
    on_the_mouse = my_piece;
  }
}
function onMouseUp(event) {
  if(on_the_mouse == null) {
  } else {
    var x_modulus = (event.point["x"] - board_offset_x) % piece_size;
    var y_modulus = (event.point["y"] - board_offset_y) % piece_size;
    refined_x = event.point["x"] - x_modulus + piece_size / 2;
    refined_y = event.point["y"] - y_modulus + piece_size / 2;
    move_to = {x: refined_x , y: refined_y};
    on_the_mouse.position = move_to;
    on_the_mouse = null;
  }
}

function rectangle(x,y) {
  var path = new Path();
  path.strokeColor = 'black';
  path.add(new Point(x, y));
  path.add(new Point(x + piece_size, y));
  path.add(new Point(x + piece_size, y));
  path.add(new Point(x + piece_size, y + piece_size / 2));
  path.add(new Point(x + piece_size / 2, y + piece_size / 2));
  path.add(new Point(x + piece_size / 2, y + piece_size));
  path.add(new Point(x, y + piece_size));
  path.closed=true;
  project.activeLayer.lastChild.fillColor = 'red';
  return path;
}


</script>
